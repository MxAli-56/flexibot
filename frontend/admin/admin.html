<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FlexiBot Admin</title>
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <div class="admin-container">
        <h2>FlexiBot Admin Dashboard</h2>
        <form id="clientForm">
            <input type="text" id="name" placeholder="Client Name" required>
            <input type="url" id="websiteURL" placeholder="Website URL" required>
            <button type="submit">Add Client</button>
        </form>

        <!-- Embed Snippet Box -->
        <div id="snippetBox"></div>
    </div>

    <script>
        const API_BASE = "http://localhost:5000/admin";

        document.getElementById("clientForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("name").value;
            const websiteURL = document.getElementById("websiteURL").value;

            const res = await fetch(`${API_BASE}/addClient`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, websiteURL })
            });

            const data = await res.json();

            if (res.ok && data.client) {
                // Clear form fields
                document.getElementById("clientForm").reset();

                // Show snippet in a separate bubble
                const snippetBox = document.getElementById("snippetBox");
                snippetBox.style.display = "block";
                snippetBox.innerHTML = `
  <div class="snippet-bubble">
    <div class="snippet-header">
      <span class="copy-icon">
        <svg xmlns="http://www.w3.org/2000/svg" 
             viewBox="0 0 24 24" width="18" height="18">
          <path fill="currentColor" 
                d="M19 21H9c-1.1 0-2-.9-2-2V7h2v12h10v2zm-4-8H5c-1.1 
                   0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 
                   0 2 .9 2 2v8c0 1.1-.9 2-2 2zm0-10H5v8h10V3z"/>
        </svg>
      </span>
    </div>
    <pre id="snippetPre" class="snippet-content">
${data.client.embedCode.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
    </pre>
  </div>
`;
                // Copy functionality
                const pre = document.getElementById("snippetPre");
                const icon = document.querySelector(".copy-icon");
                icon.onclick = () => {
                    navigator.clipboard.writeText(pre.innerText.replace(/&lt;/g, "<").replace(/&gt;/g, ">"));
                };
            }
        })
    </script>
</body>

</html>